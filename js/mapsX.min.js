/*
Autor: Arturo Arista R. (xaristax)
Fecha: 2013
Licencia: GNU General Public License
*/

(function(e){e.fn.extend({mapa:function(t){function d(){latlng=new google.maps.LatLng(r.latitud,r.longitud);var e={center:latlng,zoom:r.zoom,mapTypeId:r.tipo};map=new google.maps.Map(document.getElementById("contenedorMapa"),e);if(r.animado){marker.setAnimation(google.maps.Animation.BOUNCE)}}function v(){latlng=new google.maps.LatLng(r.latitud,r.longitud);directionsDisplay=new google.maps.DirectionsRenderer;var e={center:new google.maps.LatLng(r.latitud,r.longitud),zoom:r.zoom,mapTypeId:r.tipo};map=new google.maps.Map(document.getElementById("contenedorMapa"),e);directionsDisplay.setMap(map);directionsDisplay.setPanel(document.getElementById("pasosMapa"));var t=document.getElementById("puntoA");var n=new google.maps.places.Autocomplete(t);var i=document.getElementById("puntoB");var n=new google.maps.places.Autocomplete(i);n.bindTo("bounds",map);var s=new google.maps.InfoWindow;if(r.animado){marker.setAnimation(google.maps.Animation.BOUNCE)}}function m(){var t;var n;var i;var o;var u=document.getElementById("puntoA").value;var f=document.getElementById("puntoB").getAttribute("name");var l={origin:u,destination:f,travelMode:google.maps.DirectionsTravelMode.DRIVING};a.route(l,function(u,a){if(a==google.maps.DirectionsStatus.OK){t=u.routes[0].legs[0].start_location.ob;n=u.routes[0].legs[0].start_location.pb;i=u.routes[0].legs[0].end_location.ob;o=u.routes[0].legs[0].end_location.pb;if(r.videoActivo===true){h.css("display","block");if(e("#loaderMAPSX").length>0){h.html("<img src='"+r.loaderIMG+"' />")}if(p.find("canvas").length>0){s.reset();p.find("canvas").remove()}g(t,n,i,o)}directionsDisplay.setDirections(u)}else{alert("Complete todos los campos o verifique su ruta")}})}function g(e,t,n,i){s=new Hyperlapse(document.getElementById("pano"),{lookat:new google.maps.LatLng(n,i),zoom:1,width:r.width,height:r.height,use_lookat:false,elevation:50,distance_between_points:r.videoDistancia,millis:r.videoVelocidad});s.onError=function(e){alert("Su navegador no permite mostrar el modo video")};s.onRouteComplete=function(e){s.load()};s.onLoadComplete=function(e){h.html("<input id='videoBTNMAPSX' type='button' value='Ver Video' />");h.find("input[type='button']").css({display:"block",margin:"5px auto",color:"#FFF",backgroundColor:"#4387f4",border:"solid 2px #43a3f4"});if(r.videoAutoplay===true){p.css({display:"block",opacity:0});p.animate({opacity:1},500)}h.find("input[type='button']").bind("click",function(){p.css({display:"block",opacity:0});p.animate({opacity:1},500)})};var o=new google.maps.DirectionsService;var u={request:{origin:new google.maps.LatLng(e,t),destination:new google.maps.LatLng(n,i),travelMode:google.maps.DirectionsTravelMode.DRIVING}};o.route(u.request,function(e,t){if(t==google.maps.DirectionsStatus.OK){s.generate({route:e})}else{console.log(t)}})}var n={rol:"mapa",tipo:"normal",animado:false,icono:"",zoom:15,titulo:"Inicio",latitud:19.440755,longitud:-99.141483,width:800,height:600,addr1:"",addr2:"",mascara:"",lock1:false,lock2:false,loaderIMG:"loader.gif",videoActivo:false,videoVelocidad:100,videoDistancia:5,videoAutoplay:false,videoPausaIMG:false,videoPlayIMG:false,videoStopIMG:false};var r=e.extend(n,t);var i=e(this);var s;i.css({position:"relative",width:r.width,height:r.height,border:"solid 2px #6b6b6b"});var o=e("<div id='contenedorMapa' />");switch(r.tipo){case"hibrido":r.tipo=google.maps.MapTypeId.HYBRID;break;case"normal":r.tipo=google.maps.MapTypeId.ROADMAP;break;case"satelite":r.tipo=google.maps.MapTypeId.SATELLITE;break;case"relieve":r.tipo=google.maps.MapTypeId.TERRAIN;break;default:r.tipo=google.maps.MapTypeId.ROADMAP;break}var u;var a=new google.maps.DirectionsService;switch(r.rol){case"mapa":o.css({width:"100%",height:"100%","float":"left"});i.append(o);d();break;case"busqueda":o.css({width:"60%",height:"100%","float":"left"});var f="";var l="";if(r.lock1){f="disabled='disabled'"}if(r.lock2){l="disabled='disabled'"}var c=e("<div id='pasosMapa'><input id='puntoA' type='text' value='"+r.addr1+"' "+f+" /><input id='puntoB' type='text' value='"+r.mascara+"' name='"+r.addr2+"' "+l+" /><input id='buscarRuta' type='button' value='Buscar Ruta' /></div>");var h=e("<div id='loaderMAPSX' style='position:absolute;bottom:15px;right:10px;z-index:9;display:none' ><img src='"+r.loaderIMG+"' />'</div>");var p=e("<div id='pano' style='position:absolute;z-index:10;display:none'><div id='controlesMAPSX' style='position:absolute;bottom:10px;right:5px'><img id='pausaBTNMAPSX' style='width:25px;margin-right:5px;cursor:pointer' src='"+r.videoPausaIMG+"' /><img id='playBTNMAPSX' style='width:25px;margin-right:5px;cursor:pointer' src='"+r.videoPlayIMG+"' /><img id='stopBTNMAPSX' style='width:25px;margin-right:5px;cursor:pointer' src='"+r.videoStopIMG+"' /></div></div>");c.find("input[type='text']").css({width:"80%",display:"block",margin:"10px auto",padding:5});c.find("input[type='button']").css({width:"50%",display:"block",margin:"5px auto",color:"#FFF",backgroundColor:"#4387f4",border:"solid 2px #43a3f4"});c.css({width:"40%",height:"100%",backgroundColor:"#efefef","float":"left",overflow:"auto"});i.append(c);i.append(o);i.prepend(p);i.prepend(h);e("#buscarRuta").bind("click",m);e("#pausaBTNMAPSX").bind("click",function(){s.pause()});e("#playBTNMAPSX").bind("click",function(){s.play()});e("#stopBTNMAPSX").bind("click",function(){s.pause();p.animate({opacity:0},500,function(){p.css("display","none")})});v();break}}});e.fn.extend({agregarPunto:function(t){var n={latitud:19.442536,longitud:-99.14291,animado:false,icono:"",titulo:"Marcador"};var r=e.extend(n,t);var i=new google.maps.LatLng(r.latitud,r.longitud);var s=new google.maps.Marker({position:i,map:map,icon:r.icono,title:r.titulo});if(r.animado){s.setAnimation(google.maps.Animation.BOUNCE)}}})})(jQuery)
